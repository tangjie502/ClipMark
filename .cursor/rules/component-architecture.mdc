---
description: "ClipMarkç»„ä»¶æ¶æ„å’Œæ•°æ®æµè®¾è®¡è§„èŒƒ"
---

# ClipMark ç»„ä»¶æ¶æ„è§„èŒƒ

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### ç»„ä»¶åˆ†å±‚æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·ç•Œé¢å±‚ (UI Layer)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Popup  â”‚ â”‚ Options â”‚ â”‚ Preview â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        ä¸šåŠ¡é€»è¾‘å±‚ (Logic Layer)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚      Service Worker           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       å†…å®¹å¤„ç†å±‚ (Content Layer)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Content â”‚ â”‚  Page   â”‚ â”‚ Context â”‚â”‚
â”‚  â”‚ Script  â”‚ â”‚ Context â”‚ â”‚ Menus   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        æ ¸å¿ƒåº“å±‚ (Core Layer)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚Readabil-â”‚ â”‚Turndown â”‚ â”‚ Default â”‚â”‚
â”‚  â”‚ity.js   â”‚ â”‚  .js    â”‚ â”‚ Options â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“± UIç»„ä»¶è®¾è®¡è§„èŒƒ

### Popup ç»„ä»¶ ([popup/](mdc:src/popup/))
**èŒè´£ï¼š** ä¸»è¦ç”¨æˆ·äº¤äº’ç•Œé¢ï¼Œå¤„ç†å‰ªè—æ“ä½œ
- **æ•°æ®è¾“å…¥ï¼š** ç”¨æˆ·é€‰æ‹©çš„å†…å®¹ã€è®¾ç½®é€‰é¡¹
- **æ•°æ®è¾“å‡ºï¼š** è½¬æ¢åçš„Markdownå†…å®¹
- **å…³é”®æ–‡ä»¶ï¼š** 
  - [popup.html](mdc:src/popup/popup.html) - ç•Œé¢ç»“æ„
  - [popup.js](mdc:src/popup/popup.js) - äº¤äº’é€»è¾‘
  - [popup.css](mdc:src/popup/popup.css) - æ ·å¼å®šä¹‰

### Options ç»„ä»¶ ([options/](mdc:src/options/))
**èŒè´£ï¼š** æ‰©å±•è®¾ç½®ç®¡ç†ç•Œé¢
- **é…ç½®ç®¡ç†ï¼š** ç”¨æˆ·åå¥½è®¾ç½®ã€æ¨¡æ¿é…ç½®
- **æ•°æ®æŒä¹…åŒ–ï¼š** ä½¿ç”¨ `chrome.storage.sync` å­˜å‚¨è®¾ç½®
- **å®æ—¶é¢„è§ˆï¼š** è®¾ç½®å˜æ›´çš„å³æ—¶åé¦ˆ

### Preview ç»„ä»¶ ([preview/](mdc:src/preview/))
**èŒè´£ï¼š** Markdownå†…å®¹é¢„è§ˆå’Œç¼–è¾‘
- **å†…å®¹æ¸²æŸ“ï¼š** å®æ—¶Markdowné¢„è§ˆ
- **ç¼–è¾‘å™¨é›†æˆï¼š** CodeMirrorç¼–è¾‘å™¨ç»„ä»¶
- **å¯¼å‡ºåŠŸèƒ½ï¼š** ä¸‹è½½ã€å¤åˆ¶åˆ°å‰ªè´´æ¿ç­‰æ“ä½œ

## âš™ï¸ ä¸šåŠ¡é€»è¾‘å±‚è®¾è®¡

### Service Worker ([service-worker.js](mdc:src/service-worker.js))
**æ ¸å¿ƒèŒè´£ï¼š**
- **æ¶ˆæ¯è·¯ç”±ï¼š** å¤„ç†å„ç»„ä»¶é—´çš„æ¶ˆæ¯ä¼ é€’
- **åå°ä»»åŠ¡ï¼š** æ–‡ä»¶ä¸‹è½½ã€æ‰¹é‡å¤„ç†ç­‰
- **ä¸Šä¸‹æ–‡èœå•ï¼š** å³é”®èœå•äº‹ä»¶å¤„ç†
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š** æ‰©å±•å®‰è£…ã€æ›´æ–°äº‹ä»¶

**é€šä¿¡æ¥å£è®¾è®¡ï¼š**
```javascript
// æ ‡å‡†æ¶ˆæ¯æ ¼å¼
{
  action: "convertToMarkdown",    // æ“ä½œç±»å‹
  data: {                        // æ•°æ®è½½è·
    html: "<html>...",
    title: "é¡µé¢æ ‡é¢˜",
    url: "https://example.com"
  },
  options: {                     // è½¬æ¢é€‰é¡¹
    downloadImages: true,
    includeTemplate: false
  }
}
```

## ğŸŒ å†…å®¹å¤„ç†å±‚è®¾è®¡

### Content Script ([contentScript/](mdc:src/contentScript/))
**èŒè´£ï¼š** ç½‘é¡µå†…å®¹æå–å’ŒDOMæ“ä½œ
- **å†…å®¹æå–ï¼š** é€‰ä¸­æ–‡æœ¬æˆ–å…¨é¡µé¢å†…å®¹
- **DOMéå†ï¼š** æ™ºèƒ½è¯†åˆ«ä¸»è¦å†…å®¹åŒºåŸŸ
- **äº‹ä»¶ç›‘å¬ï¼š** ç”¨æˆ·é€‰æ‹©æ“ä½œã€å¿«æ·é”®å¤„ç†

**ä¸é¡µé¢äº¤äº’æ¨¡å¼ï¼š**
```javascript
// æ³¨å…¥é¡µé¢ä¸Šä¸‹æ–‡è„šæœ¬
function injectPageScript() {
  const script = document.createElement("script");
  script.src = chrome.runtime.getURL("contentScript/pageContext.js");
  document.documentElement.appendChild(script);
}
```

### Context Menus ([shared/context-menus.js](mdc:src/shared/context-menus.js))
**èŒè´£ï¼š** å³é”®èœå•åŠŸèƒ½å®ç°
- **èœå•åˆ›å»ºï¼š** åŠ¨æ€åˆ›å»ºä¸Šä¸‹æ–‡èœå•é¡¹
- **æƒé™æ£€æŸ¥ï¼š** æ ¹æ®é¡µé¢çŠ¶æ€å¯ç”¨/ç¦ç”¨èœå•
- **æ‰¹é‡æ“ä½œï¼š** æ”¯æŒå¤šé“¾æ¥é€‰æ‹©å’Œå¤„ç†

## ğŸ”§ æ ¸å¿ƒåº“å±‚è®¾è®¡

### å†…å®¹æå–å¼•æ“
**Readability.js é›†æˆ** ([background/Readability.js](mdc:src/background/Readability.js))
- **ç®—æ³•ä¼˜åŒ–ï¼š** Mozilla Readabilityç®—æ³•
- **å†…å®¹æ¸…ç†ï¼š** ç§»é™¤å¹¿å‘Šã€å¯¼èˆªç­‰æ— å…³å†…å®¹
- **å…ƒæ•°æ®æå–ï¼š** æ ‡é¢˜ã€ä½œè€…ã€å‘å¸ƒæ—¶é—´ç­‰

### Markdownè½¬æ¢å¼•æ“
**Turndown.js é…ç½®** ([background/turndown.js](mdc:src/background/turndown.js))
- **è½¬æ¢è§„åˆ™ï¼š** HTMLåˆ°Markdownçš„æ˜ å°„è§„åˆ™
- **æ’ä»¶ç³»ç»Ÿï¼š** GFMï¼ˆGitHub Flavored Markdownï¼‰æ”¯æŒ
- **è‡ªå®šä¹‰è§„åˆ™ï¼š** ç‰¹æ®Šå…ƒç´ çš„å¤„ç†é€»è¾‘

### é…ç½®ç®¡ç†ç³»ç»Ÿ
**é»˜è®¤é€‰é¡¹ç®¡ç†** ([shared/default-options.js](mdc:src/shared/default-options.js))
```javascript
const DEFAULT_OPTIONS = {
  downloadImages: true,           // ä¸‹è½½å›¾ç‰‡
  includeTemplate: false,         // åŒ…å«æ¨¡æ¿
  turndownGfm: true,             // å¯ç”¨GFM
  frontmatter: "",               // å‰ç½®æ¨¡æ¿
  backmatter: "",                // åç½®æ¨¡æ¿
  // ... å…¶ä»–é…ç½®é¡¹
};
```

## ğŸ”„ æ•°æ®æµè®¾è®¡

### æ ‡å‡†å‰ªè—æµç¨‹
1. **ç”¨æˆ·è§¦å‘** â†’ Popupç•Œé¢æ˜¾ç¤º
2. **å†…å®¹è·å–** â†’ Content Scriptæå–é¡µé¢å†…å®¹
3. **æ•°æ®å¤„ç†** â†’ Service Workerè°ƒç”¨Readability.jsæ¸…ç†å†…å®¹
4. **æ ¼å¼è½¬æ¢** â†’ ä½¿ç”¨Turndown.jsè½¬æ¢ä¸ºMarkdown
5. **ç»“æœå±•ç¤º** â†’ Previewç»„ä»¶æ˜¾ç¤ºè½¬æ¢ç»“æœ
6. **ç”¨æˆ·ç¡®è®¤** â†’ ä¸‹è½½æ–‡ä»¶æˆ–å¤åˆ¶åˆ°å‰ªè´´æ¿

### è®¾ç½®åŒæ­¥æµç¨‹
1. **ç”¨æˆ·ä¿®æ”¹è®¾ç½®** â†’ Optionsé¡µé¢
2. **æ•°æ®éªŒè¯** â†’ å‰ç«¯è¡¨å•éªŒè¯
3. **å­˜å‚¨æ›´æ–°** â†’ chrome.storage.syncä¿å­˜
4. **ç»„ä»¶é€šçŸ¥** â†’ å¹¿æ’­è®¾ç½®å˜æ›´æ¶ˆæ¯
5. **ç•Œé¢æ›´æ–°** â†’ å„ç»„ä»¶æ ¹æ®æ–°è®¾ç½®æ›´æ–°ç•Œé¢

## ğŸ¯ ç»„ä»¶é€šä¿¡è§„èŒƒ

### æ¶ˆæ¯ä¼ é€’æœºåˆ¶
- **å•å‘é€šä¿¡ï¼š** Content Script â†’ Service Worker â†’ UI Components
- **åŒå‘é€šä¿¡ï¼š** UI Components â†” Service Worker
- **äº‹ä»¶å¹¿æ’­ï¼š** Service Worker â†’ All Components (è®¾ç½®å˜æ›´é€šçŸ¥)

### é”™è¯¯ä¼ æ’­æœºåˆ¶
- **é”™è¯¯æ•è·ï¼š** å„ç»„ä»¶å†…éƒ¨try-catchå¤„ç†
- **é”™è¯¯ä¸ŠæŠ¥ï¼š** ç»Ÿä¸€é”™è¯¯å¤„ç†å‡½æ•°
- **ç”¨æˆ·åé¦ˆï¼š** å‹å¥½çš„é”™è¯¯æç¤ºç•Œé¢

## ğŸš€ æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### ç»„ä»¶æ‡’åŠ è½½
- **æŒ‰éœ€åˆå§‹åŒ–ï¼š** åªåœ¨éœ€è¦æ—¶åŠ è½½ç»„ä»¶
- **èµ„æºåˆ†ç¦»ï¼š** å°†å¤§å‹åº“æ–‡ä»¶å•ç‹¬ç®¡ç†
- **ç¼“å­˜ç­–ç•¥ï¼š** åˆç†ä½¿ç”¨æµè§ˆå™¨ç¼“å­˜

### å†…å­˜ç®¡ç†
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š** ç»„ä»¶åˆ›å»ºå’Œé”€æ¯æ—¶æœº
- **äº‹ä»¶æ¸…ç†ï¼š** ç§»é™¤ä¸å†ä½¿ç”¨çš„äº‹ä»¶ç›‘å¬å™¨
- **æ•°æ®æ¸…ç†ï¼š** å®šæœŸæ¸…ç†ä¸´æ—¶æ•°æ®å’Œç¼“å­˜